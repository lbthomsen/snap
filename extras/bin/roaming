#!/bin/bash

while [ ! -S /var/run/openvswitch/db.sock ]; do
    sleep 1
done

iface=$(route | grep '^default' | grep -o '[^ ]*$')

while true; do
	timeout 5 dhclient eth1
	timeout 5 dhclient eth2
	timeout 15 dhclient $iface 
       	if [ "$?" != "0" ]; then
		dhclient -r $iface
	fi
	pkill dhclient
	sleep 20
done
