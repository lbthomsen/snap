#!/bin/bash
while [ ! -S /var/run/openvswitch/db.sock ]; do
    sleep 1
done

wan="$(ovs-vsctl list-br | grep -c wan)"
if [ "$wan" == "1" ]; then
        ovs-vsctl del-br wan && ifconfig wan down
fi

if [ "$(cat /proc/scsi/scsi | grep -c VBOX)" != "0" ]; then
	while true; do
		timeout 10 dhclient eth1
	        timeout 10 dhclient eth2
        	timeout 15 dhclient eth0
	        if [ "$?" != "0" ]; then
                	dhclient -r eth0
        	fi
	        pkill dhclient
        	sleep 20
	done
fi
